import{_ as R}from"./_plugin-vue_export-helper-BCEt7Ct6.js";/* empty css                   *//* empty css                 *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                *//* empty css               *//* empty css                  */import{r as g,F as A,a0 as G,c as v,o as r,d as t,w as e,K as J,I as y,m as C,b as a,G as K,J as O,v as o,t as U,x as m,aq as j,L as H,O as W,M as X,Q as Y,R as Z,n as S,aa as $,ab as Q,l as c,V as tt,P as st,a1 as at,a6 as et,k as nt,a7 as lt}from"./index-DURBC1W6.js";const ot={class:"queue-monitoring"},it={class:"card-header"},ut={class:"stat-content"},dt={class:"stat-number"},rt={class:"stat-content"},ct={class:"stat-number"},_t={class:"stat-content"},pt={class:"stat-number"},mt={class:"stat-content"},ft={class:"stat-number"},gt={class:"pile-queues"},vt={class:"pile-header"},ht={class:"pile-name"},wt={class:"queue-content"},bt={class:"queue-stats"},qt={class:"stat-item"},yt={class:"value"},Mt={class:"stat-item"},Et={class:"value"},Tt={class:"stat-item"},xt={class:"value"},kt={key:0,class:"queue-details"},Ct={key:1,class:"no-queue"},St={class:"queue-logs"},zt={__name:"QueueMonitoring",setup(Bt){const h=g(!1),_=g({total_queues:0,charging_count:0,waiting_count:0,avg_wait_time:0}),M=g([]),E=g([]);let w=null;const b=async()=>{h.value=!0;try{const n=await y.get("/admin/queue/summary");_.value=n;const s=await y.get("/admin/queue/piles");M.value=s;const u=await y.get("/admin/queue/logs");E.value=u.slice(0,20)}catch(n){console.error("获取队列数据失败:",n),C.error("获取队列数据失败")}finally{h.value=!1}},z=()=>{b(),C.success("数据已刷新")},B=n=>({normal:"success",charging:"warning",fault:"danger",maintenance:"info"})[n]||"info",D=n=>({normal:"空闲",charging:"充电中",fault:"故障",maintenance:"维护中"})[n]||"未知",I=n=>({waiting:"warning",charging:"success",completed:"info"})[n]||"info",L=n=>({waiting:"等待",charging:"充电中",completed:"已完成"})[n]||"未知",N=n=>({加入队列:"success",开始充电:"warning",完成充电:"info",取消排队:"danger"})[n]||"info",T=n=>n?new Date(n).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):"-";return A(()=>{b(),w=setInterval(()=>{b()},3e4)}),G(()=>{w&&clearInterval(w)}),(n,s)=>{const u=U,V=nt,d=J,p=O,x=K,q=tt,i=Q,k=$,P=st,F=et;return r(),v("div",ot,[t(d,null,{header:e(()=>[a("div",it,[s[1]||(s[1]=a("span",null,"队列监控",-1)),t(V,{onClick:z},{default:e(()=>[t(u,null,{default:e(()=>[t(m(lt))]),_:1}),s[0]||(s[0]=c(" 刷新 "))]),_:1,__:[0]})])]),default:e(()=>[t(x,{gutter:20,class:"stats-row"},{default:e(()=>[t(p,{span:6},{default:e(()=>[t(d,{class:"stat-card"},{default:e(()=>[a("div",ut,[a("div",dt,o(_.value.total_queues),1),s[2]||(s[2]=a("div",{class:"stat-label"},"总排队人数",-1))]),t(u,{class:"stat-icon"},{default:e(()=>[t(m(j))]),_:1})]),_:1})]),_:1}),t(p,{span:6},{default:e(()=>[t(d,{class:"stat-card"},{default:e(()=>[a("div",rt,[a("div",ct,o(_.value.charging_count),1),s[3]||(s[3]=a("div",{class:"stat-label"},"正在充电",-1))]),t(u,{class:"stat-icon"},{default:e(()=>[t(m(H))]),_:1})]),_:1})]),_:1}),t(p,{span:6},{default:e(()=>[t(d,{class:"stat-card"},{default:e(()=>[a("div",_t,[a("div",pt,o(_.value.waiting_count),1),s[4]||(s[4]=a("div",{class:"stat-label"},"等待充电",-1))]),t(u,{class:"stat-icon"},{default:e(()=>[t(m(W))]),_:1})]),_:1})]),_:1}),t(p,{span:6},{default:e(()=>[t(d,{class:"stat-card"},{default:e(()=>[a("div",mt,[a("div",ft,o(_.value.avg_wait_time)+"min",1),s[5]||(s[5]=a("div",{class:"stat-label"},"平均等待时间",-1))]),t(u,{class:"stat-icon"},{default:e(()=>[t(m(X))]),_:1})]),_:1})]),_:1})]),_:1}),a("div",gt,[s[10]||(s[10]=a("h3",null,"各充电桩队列状态",-1)),t(x,{gutter:20},{default:e(()=>[(r(!0),v(Y,null,Z(M.value,l=>(r(),S(p,{span:12,key:l.pile_id},{default:e(()=>[t(d,{class:"pile-queue-card"},{header:e(()=>[a("div",vt,[a("span",ht,o(l.pile_name),1),t(q,{type:B(l.pile_status)},{default:e(()=>[c(o(D(l.pile_status)),1)]),_:2},1032,["type"])])]),default:e(()=>[a("div",wt,[a("div",bt,[a("div",qt,[s[6]||(s[6]=a("span",{class:"label"},"排队人数:",-1)),a("span",yt,o(l.queue_length),1)]),a("div",Mt,[s[7]||(s[7]=a("span",{class:"label"},"当前用户:",-1)),a("span",Et,o(l.current_user||"无"),1)]),a("div",Tt,[s[8]||(s[8]=a("span",{class:"label"},"预计等待:",-1)),a("span",xt,o(l.estimated_wait_time)+"分钟",1)])]),l.queue_details&&l.queue_details.length>0?(r(),v("div",kt,[s[9]||(s[9]=a("h4",null,"排队详情",-1)),t(k,{data:l.queue_details,size:"small"},{default:e(()=>[t(i,{prop:"position",label:"位置",width:"60"}),t(i,{prop:"username",label:"用户",width:"100"}),t(i,{prop:"vehicle_info",label:"车辆",width:"120"}),t(i,{prop:"request_time",label:"请求时间",width:"120"},{default:e(f=>[c(o(T(f.row.request_time)),1)]),_:1}),t(i,{prop:"status",label:"状态",width:"80"},{default:e(f=>[t(q,{size:"small",type:I(f.row.status)},{default:e(()=>[c(o(L(f.row.status)),1)]),_:2},1032,["type"])]),_:1})]),_:2},1032,["data"])])):(r(),v("div",Ct,[t(P,{description:"当前无人排队","image-size":60})]))])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),a("div",St,[s[11]||(s[11]=a("h3",null,"实时队列变化",-1)),at((r(),S(k,{data:E.value,style:{width:"100%","max-height":"300px"}},{default:e(()=>[t(i,{prop:"timestamp",label:"时间",width:"120"},{default:e(l=>[c(o(T(l.row.timestamp)),1)]),_:1}),t(i,{prop:"pile_name",label:"充电桩",width:"120"}),t(i,{prop:"user",label:"用户",width:"100"}),t(i,{prop:"action",label:"动作",width:"100"},{default:e(l=>[t(q,{size:"small",type:N(l.row.action)},{default:e(()=>[c(o(l.row.action),1)]),_:2},1032,["type"])]),_:1}),t(i,{prop:"description",label:"描述"})]),_:1},8,["data"])),[[F,h.value]])])]),_:1})])}}},Jt=R(zt,[["__scopeId","data-v-26d8a95e"]]);export{Jt as default};
