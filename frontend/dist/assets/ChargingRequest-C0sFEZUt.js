import{_ as G}from"./_plugin-vue_export-helper-BCEt7Ct6.js";/* empty css               *//* empty css                   *//* empty css                *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                  *//* empty css                     */import{r as b,a as E,W as T,F as J,c as m,o as u,b as t,d as a,w as l,G as K,I as p,J as L,K as O,E as Q,h as X,S as C,X as Y,Q as Z,R as j,n as z,Y as A,v as g,Z as H,_ as P,l as d,$ as ee,k as te,T as ae,m as le}from"./index-DURBC1W6.js";const se={class:"charging-request"},ne={key:0,class:"vehicle-info"},oe={class:"amount-info"},ie={key:0},re={class:"card-header"},ue={class:"waiting-info"},de={class:"waiting-item"},ce={class:"waiting-value"},_e={class:"waiting-item"},me={class:"waiting-value"},pe={__name:"ChargingRequest",setup(ge){const r=b(),f=b(!1),v=b([]),c=E({fast:0,trickle:0}),n=E({vehicle_id:null,charging_mode:"fast",requested_amount:10}),R={vehicle_id:[{required:!0,message:"请选择车辆",trigger:"change"}],charging_mode:[{required:!0,message:"请选择充电模式",trigger:"change"}],requested_amount:[{required:!0,message:"请输入充电量",trigger:"blur"},{type:"number",min:1,message:"充电量不能小于1度",trigger:"blur"}]},i=T(()=>v.value.find(o=>o.id===n.vehicle_id)),x=()=>{i.value&&(n.requested_amount=Math.min(10,i.value.battery_capacity))},F=async()=>{try{v.value=await p.get("/users/vehicles")}catch(o){console.error("获取车辆列表失败:",o)}},w=async()=>{try{const o=await p.get("/charging/waiting-count/fast"),e=await p.get("/charging/waiting-count/trickle");c.fast=o.waiting_count,c.trickle=e.waiting_count}catch(o){console.error("获取等待信息失败:",o)}},I=async()=>{r.value&&await r.value.validate(async o=>{if(o){f.value=!0;try{const e=await p.post("/charging/request",n);le.success(`充电请求提交成功！排队号码: ${e.queue_number}`),h(),w()}catch(e){console.error("提交充电请求失败:",e)}finally{f.value=!1}}})},h=()=>{r.value&&r.value.resetFields()};return J(()=>{F(),w()}),(o,e)=>{const B=A,N=Y,_=X,q=P,W=H,$=ee,y=te,M=Q,k=O,V=L,S=ae,U=K;return u(),m("div",se,[e[14]||(e[14]=t("h1",null,"充电请求",-1)),a(U,{gutter:20},{default:l(()=>[a(V,{span:12},{default:l(()=>[a(k,null,{header:l(()=>e[3]||(e[3]=[t("div",{class:"card-header"},[t("span",null,"提交充电请求")],-1)])),default:l(()=>[a(M,{ref_key:"requestFormRef",ref:r,model:n,rules:R,"label-width":"120px"},{default:l(()=>[a(_,{label:"选择车辆",prop:"vehicle_id"},{default:l(()=>[a(N,{modelValue:n.vehicle_id,"onUpdate:modelValue":e[0]||(e[0]=s=>n.vehicle_id=s),placeholder:"请选择车辆",style:{width:"100%"},onChange:x},{default:l(()=>[(u(!0),m(Z,null,j(v.value,s=>(u(),z(B,{key:s.id,label:`${s.license_plate} (${s.model||"未知型号"})`,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i.value?(u(),m("div",ne," 电池容量: "+g(i.value.battery_capacity)+"度 ",1)):C("",!0)]),_:1}),a(_,{label:"充电模式",prop:"charging_mode"},{default:l(()=>[a(W,{modelValue:n.charging_mode,"onUpdate:modelValue":e[1]||(e[1]=s=>n.charging_mode=s)},{default:l(()=>[a(q,{label:"fast"},{default:l(()=>e[4]||(e[4]=[d("快充 (30度/小时)")])),_:1,__:[4]}),a(q,{label:"trickle"},{default:l(()=>e[5]||(e[5]=[d("慢充 (10度/小时)")])),_:1,__:[5]})]),_:1},8,["modelValue"])]),_:1}),a(_,{label:"充电量",prop:"requested_amount"},{default:l(()=>{var s;return[a($,{modelValue:n.requested_amount,"onUpdate:modelValue":e[2]||(e[2]=D=>n.requested_amount=D),min:1,max:((s=i.value)==null?void 0:s.battery_capacity)||100,step:1,style:{width:"100%"}},null,8,["modelValue","max"]),t("div",oe,[e[6]||(e[6]=t("span",null,"单位: 度 (kWh)",-1)),i.value?(u(),m("span",ie," 最大: "+g(i.value.battery_capacity)+"度 ",1)):C("",!0)])]}),_:1}),a(_,null,{default:l(()=>[a(y,{type:"primary",loading:f.value,onClick:I},{default:l(()=>e[7]||(e[7]=[d(" 提交请求 ")])),_:1,__:[7]},8,["loading"]),a(y,{onClick:h},{default:l(()=>e[8]||(e[8]=[d("重置")])),_:1,__:[8]})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),a(V,{span:12},{default:l(()=>[a(k,null,{header:l(()=>[t("div",re,[e[10]||(e[10]=t("span",null,"当前等待情况",-1)),a(y,{type:"text",onClick:w},{default:l(()=>e[9]||(e[9]=[d("刷新")])),_:1,__:[9]})])]),default:l(()=>[t("div",ue,[t("div",de,[e[11]||(e[11]=t("div",{class:"waiting-label"},"快充等待数量:",-1)),t("div",ce,g(c.fast)+"辆",1)]),t("div",_e,[e[12]||(e[12]=t("div",{class:"waiting-label"},"慢充等待数量:",-1)),t("div",me,g(c.trickle)+"辆",1)])]),a(S),e[13]||(e[13]=t("div",{class:"pricing-info"},[t("h3",null,"计费说明"),t("div",{class:"price-table"},[t("div",{class:"price-row"},[t("span",null,"峰时 (10:00-15:00, 18:00-21:00)"),t("span",null,"1.0元/度")]),t("div",{class:"price-row"},[t("span",null,"平时 (7:00-10:00, 15:00-18:00, 21:00-23:00)"),t("span",null,"0.7元/度")]),t("div",{class:"price-row"},[t("span",null,"谷时 (23:00-次日7:00)"),t("span",null,"0.4元/度")]),t("div",{class:"price-row"},[t("span",null,"服务费"),t("span",null,"0.8元/度")])])],-1))]),_:1,__:[13]})]),_:1})]),_:1})])}}},Re=G(pe,[["__scopeId","data-v-456e2589"]]);export{Re as default};
