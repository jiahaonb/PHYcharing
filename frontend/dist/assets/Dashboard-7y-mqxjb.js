import{_ as Z}from"./_plugin-vue_export-helper-BCEt7Ct6.js";/* empty css                *//* empty css                   *//* empty css                   *//* empty css                 *//* empty css                  *//* empty css               */import{a as tt,r as g,F as et,c as r,o as u,b as e,d as l,w as a,G as st,H as lt,I as M,f as at,g as it,J as ot,K as dt,t as nt,x as w,L as ut,v as i,M as rt,N as ct,O as _t,P as vt,Q as B,R as L,k as mt,l as _,S as v,T as ft,n as pt,U as gt,V as ht,m as D}from"./index-DURBC1W6.js";const yt={class:"dashboard"},bt={class:"stat-content"},kt={class:"stat-icon"},wt={class:"stat-info"},Ct={class:"stat-number"},xt={class:"stat-content"},Dt={class:"stat-icon"},qt={class:"stat-info"},Ft={class:"stat-number"},Mt={class:"stat-content"},Vt={class:"stat-icon"},Et={class:"stat-info"},Rt={class:"stat-number"},Tt={class:"stat-content"},$t={class:"stat-icon"},zt={class:"stat-info"},Nt={class:"stat-number"},Qt={class:"card-header"},Bt={key:0,class:"empty-state"},Lt={key:1},St={class:"queue-info"},It={class:"queue-number"},Ut={class:"queue-details"},Pt={class:"queue-actions"},At={class:"card-header"},Gt={key:0,class:"empty-state"},Ht={key:1},Jt={class:"record-info"},Kt={class:"record-number"},Ot={class:"record-details"},jt={class:"record-actions"},Wt={key:0,class:"record-detail"},Xt={class:"detail-header"},Yt={class:"detail-date"},Zt={class:"detail-section"},te={class:"detail-item"},ee={class:"detail-value"},se={class:"detail-item"},le={class:"detail-value"},ae={class:"detail-item"},ie={class:"detail-value"},oe={class:"detail-item"},de={class:"detail-value"},ne={class:"detail-section"},ue={class:"detail-item"},re={class:"detail-value"},ce={class:"detail-item"},_e={class:"detail-value"},ve={class:"detail-item"},me={class:"detail-value"},fe={class:"detail-item"},pe={class:"detail-value"},ge={class:"detail-item total"},he={class:"detail-value"},ye={class:"dialog-footer"},be={key:0,class:"queue-detail"},ke={class:"detail-header"},we={class:"detail-date"},Ce={class:"detail-section"},xe={class:"detail-item"},De={class:"detail-value"},qe={class:"detail-item"},Fe={class:"detail-value"},Me={class:"detail-item"},Ve={class:"detail-value"},Ee={class:"detail-item"},Re={class:"detail-value"},Te={key:0,class:"detail-section"},$e={key:0,class:"detail-item"},ze={class:"detail-value"},Ne={key:1,class:"detail-item"},Qe={class:"detail-value"},Be={key:2,class:"detail-item"},Le={class:"detail-value"},Se={key:3,class:"detail-item"},Ie={class:"detail-value"},Ue={key:1,class:"detail-section"},Pe={key:0,class:"detail-item"},Ae={class:"detail-value"},Ge={class:"detail-item"},He={class:"detail-value"},Je={class:"dialog-footer"},Ke={__name:"Dashboard",setup(Oe){const V=at(),f=tt({totalCharging:0,totalDuration:0,totalFee:0,queueCount:0}),q=g([]),C=g([]),c=g(null),h=g(!1),o=g(null),b=g(!1),E=g(!1),R=s=>({waiting:"等候区等待",queuing:"充电区排队",charging:"正在充电",completed:"充电完成",cancelled:"已取消"})[s]||s,T=s=>s?new Date(s).toLocaleDateString("zh-CN"):"未知",k=s=>s?new Date(s).toLocaleString("zh-CN"):"未知",S=s=>{if(s==null)return"未知";const t=Math.floor(s),n=Math.round((s-t)*60);return t===0?`${n}分钟`:n===0?`${t}小时`:`${t}小时${n}分钟`},I=s=>({peak:"峰时段",normal:"平时段",valley:"谷时段"})[s]||s,U=s=>({waiting:"warning",queuing:"info",charging:"success",completed:"info",cancelled:"danger"})[s]||"",P=async()=>{try{const s=await M.get("/charging/records");f.totalCharging=s.length,f.totalDuration=s.reduce((t,n)=>t+n.charging_duration,0),f.totalFee=s.reduce((t,n)=>t+n.total_fee,0),C.value=s.slice(0,5)}catch(s){console.error("获取统计数据失败:",s)}},$=async()=>{try{const s=await M.get("/charging/queue");q.value=s,f.queueCount=s.length}catch(s){console.error("获取排队状态失败:",s)}},A=()=>{$(),D.success("排队状态已刷新")},G=async s=>{try{return E.value=!0,await M.get(`/charging/records/${s}`)}catch(t){return console.error("获取充电记录详情失败:",t),D.error("获取充电记录详情失败"),null}finally{E.value=!1}},H=async s=>{try{const t=C.value.find(n=>n.id===s);if(t&&t.total_fee&&t.charging_amount)c.value=t,h.value=!0;else{const n=await G(s);n&&(c.value=n,h.value=!0)}}catch(t){console.error("获取充电记录详情失败:",t),D.error("获取充电记录详情失败")}},J=()=>{h.value=!1,V.push("/user/records")},K=s=>{o.value=s,b.value=!0},O=()=>{b.value=!1,V.push("/user/queue")},j=s=>{if(!s||!s.start_charging_time)return 0;const t=new Date(s.start_charging_time),p=new Date-t;return Math.floor(p/(1e3*60))},W=s=>{D.success("正在准备打印..."),setTimeout(()=>{window.print()},300)};return et(()=>{P(),$()}),(s,t)=>{const n=nt,p=dt,y=ot,z=st,m=mt,N=vt,X=it("router-link"),x=ft,Q=lt,Y=ht;return u(),r("div",yt,[t[44]||(t[44]=e("h1",null,"用户仪表板",-1)),l(z,{gutter:20,class:"stats-row"},{default:a(()=>[l(y,{span:6},{default:a(()=>[l(p,{class:"stat-card"},{default:a(()=>[e("div",bt,[e("div",kt,[l(n,{size:"40",color:"#409eff"},{default:a(()=>[l(w(ut))]),_:1})]),e("div",wt,[e("div",Ct,i(f.totalCharging),1),t[5]||(t[5]=e("div",{class:"stat-label"},"总充电次数",-1))])])]),_:1})]),_:1}),l(y,{span:6},{default:a(()=>[l(p,{class:"stat-card"},{default:a(()=>[e("div",xt,[e("div",Dt,[l(n,{size:"40",color:"#67c23a"},{default:a(()=>[l(w(rt))]),_:1})]),e("div",qt,[e("div",Ft,i(f.totalDuration.toFixed(1))+"h",1),t[6]||(t[6]=e("div",{class:"stat-label"},"总充电时长",-1))])])]),_:1})]),_:1}),l(y,{span:6},{default:a(()=>[l(p,{class:"stat-card"},{default:a(()=>[e("div",Mt,[e("div",Vt,[l(n,{size:"40",color:"#e6a23c"},{default:a(()=>[l(w(ct))]),_:1})]),e("div",Et,[e("div",Rt,"¥"+i(f.totalFee.toFixed(2)),1),t[7]||(t[7]=e("div",{class:"stat-label"},"总消费金额",-1))])])]),_:1})]),_:1}),l(y,{span:6},{default:a(()=>[l(p,{class:"stat-card"},{default:a(()=>[e("div",Tt,[e("div",$t,[l(n,{size:"40",color:"#f56c6c"},{default:a(()=>[l(w(_t))]),_:1})]),e("div",zt,[e("div",Nt,i(f.queueCount),1),t[8]||(t[8]=e("div",{class:"stat-label"},"当前排队数",-1))])])]),_:1})]),_:1})]),_:1}),l(z,{gutter:20,class:"content-row"},{default:a(()=>[l(y,{span:12},{default:a(()=>[l(p,null,{header:a(()=>[e("div",Qt,[t[10]||(t[10]=e("span",null,"当前排队状态",-1)),l(m,{type:"primary",onClick:A},{default:a(()=>t[9]||(t[9]=[_("刷新")])),_:1,__:[9]})])]),default:a(()=>[q.value.length===0?(u(),r("div",Bt,[l(N,{description:"暂无排队记录"})])):(u(),r("div",Lt,[(u(!0),r(B,null,L(q.value,d=>(u(),r("div",{key:d.id,class:"queue-item"},[e("div",St,[e("div",It,i(d.queue_number||"队列 #"+d.id),1),e("div",Ut,[e("div",null,"充电模式: "+i(d.charging_mode==="fast"?"快充":"慢充"),1),e("div",null,"请求电量: "+i(d.requested_amount)+"度",1),e("div",null,"状态: "+i(R(d.status)),1)])]),e("div",Pt,[l(m,{size:"small",onClick:F=>K(d)},{default:a(()=>t[11]||(t[11]=[_("查看详情")])),_:2,__:[11]},1032,["onClick"])])]))),128))]))]),_:1})]),_:1}),l(y,{span:12},{default:a(()=>[l(p,null,{header:a(()=>[e("div",At,[t[13]||(t[13]=e("span",null,"最近充电记录",-1)),l(X,{to:"/user/records"},{default:a(()=>[l(m,{type:"text"},{default:a(()=>t[12]||(t[12]=[_("查看全部")])),_:1,__:[12]})]),_:1})])]),default:a(()=>[C.value.length===0?(u(),r("div",Gt,[l(N,{description:"暂无充电记录"})])):(u(),r("div",Ht,[(u(!0),r(B,null,L(C.value,d=>(u(),r("div",{key:d.id,class:"record-item"},[e("div",Jt,[e("div",Kt,i(d.record_number||"记录 #"+d.id),1),e("div",Ot,[e("div",null,"充电量: "+i(d.charging_amount.toFixed(2))+"度",1),e("div",null,"费用: ¥"+i(d.total_fee.toFixed(2)),1),e("div",null,"时间: "+i(T(d.start_time)),1)])]),e("div",jt,[l(m,{size:"small",onClick:F=>H(d.id)},{default:a(()=>t[14]||(t[14]=[_("查看详情")])),_:2,__:[14]},1032,["onClick"])])]))),128))]))]),_:1})]),_:1})]),_:1}),l(Q,{modelValue:h.value,"onUpdate:modelValue":t[2]||(t[2]=d=>h.value=d),title:"充电详情",width:"600px","close-on-click-modal":!1},{footer:a(()=>{var d;return[e("div",ye,[l(m,{onClick:t[0]||(t[0]=F=>h.value=!1)},{default:a(()=>t[26]||(t[26]=[_("关闭")])),_:1,__:[26]}),l(m,{type:"primary",onClick:J},{default:a(()=>t[27]||(t[27]=[_("查看全部记录")])),_:1,__:[27]}),(d=c.value)!=null&&d.id?(u(),pt(m,{key:0,type:"success",onClick:t[1]||(t[1]=F=>W(c.value.id))},{default:a(()=>[l(n,null,{default:a(()=>[l(w(gt))]),_:1}),t[28]||(t[28]=_(" 打印详单 "))]),_:1,__:[28]})):v("",!0)])]}),default:a(()=>[c.value?(u(),r("div",Wt,[e("div",Xt,[e("h3",null,"充电详单 "+i(c.value.record_number||"#"+c.value.id),1),e("p",Yt,i(T(c.value.start_time)),1)]),l(x),e("div",Zt,[t[19]||(t[19]=e("h4",null,"充电信息",-1)),e("div",te,[t[15]||(t[15]=e("div",{class:"detail-label"},"开始时间:",-1)),e("div",ee,i(k(c.value.start_time)),1)]),e("div",se,[t[16]||(t[16]=e("div",{class:"detail-label"},"结束时间:",-1)),e("div",le,i(k(c.value.end_time)),1)]),e("div",ae,[t[17]||(t[17]=e("div",{class:"detail-label"},"充电时长:",-1)),e("div",ie,i(S(c.value.charging_duration)),1)]),e("div",oe,[t[18]||(t[18]=e("div",{class:"detail-label"},"充电量:",-1)),e("div",de,i(c.value.charging_amount.toFixed(2))+" 度",1)])]),l(x),e("div",ne,[t[25]||(t[25]=e("h4",null,"费用信息",-1)),e("div",ue,[t[20]||(t[20]=e("div",{class:"detail-label"},"电费:",-1)),e("div",re,"¥"+i(c.value.electricity_fee.toFixed(2)),1)]),e("div",ce,[t[21]||(t[21]=e("div",{class:"detail-label"},"服务费:",-1)),e("div",_e,"¥"+i(c.value.service_fee.toFixed(2)),1)]),e("div",ve,[t[22]||(t[22]=e("div",{class:"detail-label"},"单价:",-1)),e("div",me,"¥"+i(c.value.unit_price.toFixed(2))+"/度",1)]),e("div",fe,[t[23]||(t[23]=e("div",{class:"detail-label"},"计费时段:",-1)),e("div",pe,i(I(c.value.time_period)),1)]),e("div",ge,[t[24]||(t[24]=e("div",{class:"detail-label"},"总计:",-1)),e("div",he,"¥"+i(c.value.total_fee.toFixed(2)),1)])])])):v("",!0)]),_:1},8,["modelValue"]),l(Q,{modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=d=>b.value=d),title:"排队详情",width:"600px","close-on-click-modal":!1},{footer:a(()=>[e("div",Je,[l(m,{onClick:t[3]||(t[3]=d=>b.value=!1)},{default:a(()=>t[42]||(t[42]=[_("关闭")])),_:1,__:[42]}),l(m,{type:"primary",onClick:O},{default:a(()=>t[43]||(t[43]=[_("查看实时状态")])),_:1,__:[43]})])]),default:a(()=>[o.value?(u(),r("div",be,[e("div",ke,[e("h3",null,"排队信息 "+i(o.value.queue_number||"#"+o.value.id),1),e("p",we,i(k(o.value.request_time)),1)]),l(x),e("div",Ce,[t[33]||(t[33]=e("h4",null,"基本信息",-1)),e("div",xe,[t[29]||(t[29]=e("div",{class:"detail-label"},"充电模式:",-1)),e("div",De,i(o.value.charging_mode==="fast"?"快充":"慢充"),1)]),e("div",qe,[t[30]||(t[30]=e("div",{class:"detail-label"},"请求电量:",-1)),e("div",Fe,i(o.value.requested_amount)+" 度",1)]),e("div",Me,[t[31]||(t[31]=e("div",{class:"detail-label"},"状态:",-1)),e("div",Ve,[l(Y,{type:U(o.value.status)},{default:a(()=>[_(i(R(o.value.status)),1)]),_:1},8,["type"])])]),e("div",Ee,[t[32]||(t[32]=e("div",{class:"detail-label"},"提交时间:",-1)),e("div",Re,i(k(o.value.request_time)),1)])]),l(x),o.value.status==="queuing"||o.value.status==="charging"?(u(),r("div",Te,[t[38]||(t[38]=e("h4",null,"排队信息",-1)),o.value.pile_name?(u(),r("div",$e,[t[34]||(t[34]=e("div",{class:"detail-label"},"充电桩:",-1)),e("div",ze,i(o.value.pile_name),1)])):v("",!0),o.value.position?(u(),r("div",Ne,[t[35]||(t[35]=e("div",{class:"detail-label"},"排队位置:",-1)),e("div",Qe,"第 "+i(o.value.position)+" 位",1)])):v("",!0),o.value.total_in_queue?(u(),r("div",Be,[t[36]||(t[36]=e("div",{class:"detail-label"},"队列总数:",-1)),e("div",Le,i(o.value.total_in_queue)+" 位",1)])):v("",!0),o.value.estimated_time!==void 0?(u(),r("div",Se,[t[37]||(t[37]=e("div",{class:"detail-label"},"预计等待:",-1)),e("div",Ie,i(o.value.estimated_time)+" 分钟",1)])):v("",!0)])):v("",!0),o.value.status==="charging"?(u(),r("div",Ue,[t[41]||(t[41]=e("h4",null,"充电信息",-1)),o.value.start_charging_time?(u(),r("div",Pe,[t[39]||(t[39]=e("div",{class:"detail-label"},"开始时间:",-1)),e("div",Ae,i(k(o.value.start_charging_time)),1)])):v("",!0),e("div",Ge,[t[40]||(t[40]=e("div",{class:"detail-label"},"已充电时长:",-1)),e("div",He,i(j(o.value))+" 分钟",1)])])):v("",!0)])):v("",!0)]),_:1},8,["modelValue"])])}}},ls=Z(Ke,[["__scopeId","data-v-a5ac3641"]]);export{ls as default};
