import{_ as z}from"./_plugin-vue_export-helper-BCEt7Ct6.js";/* empty css                        */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                *//* empty css                  *//* empty css               */import{r as f,F,am as G,c as J,o as C,d as e,w as a,G as K,m as d,I as _,J as W,K as j,b as o,t as H,x as h,L as Q,v as p,ag as U,O as X,an as Y,aa as Z,ab as tt,V as et,l as m,n as E,S as D,k as at}from"./index-DURBC1W6.js";import{i as M}from"./index-Bb6yjXMn.js";const st={class:"admin-dashboard"},ot={class:"stats-item"},nt={class:"stats-icon charging"},lt={class:"stats-content"},rt={class:"stats-number"},it={class:"stats-item"},ct={class:"stats-icon active"},ut={class:"stats-content"},dt={class:"stats-number"},_t={class:"stats-item"},pt={class:"stats-icon queue"},ft={class:"stats-content"},mt={class:"stats-number"},vt={class:"stats-item"},gt={class:"stats-icon revenue"},ht={class:"stats-content"},yt={class:"stats-number"},wt={__name:"Dashboard",setup(bt){const i=f({totalPiles:0,activePiles:0,queueLength:0,todayRevenue:0}),v=f([]),y=f(),w=f(),k=f(!1),P=s=>({charging:"success",idle:"info",fault:"danger",maintenance:"warning"})[s]||"info",R=s=>({charging:"充电中",idle:"空闲",fault:"故障",maintenance:"维护中"})[s]||"未知",S=async()=>{k.value=!0;try{await Promise.all([g(),$(),q()])}catch(s){console.error("获取仪表板数据失败:",s),d.error("获取数据失败")}finally{k.value=!1}},g=async()=>{try{const s=await _.get("/admin/piles");v.value=s.map(t=>({id:t.pile_number,type:t.charging_mode,status:t.status,power:t.power,voltage:t.charging_mode==="fast"?380:220,current:O(t),user:"待实现",startTime:"待实现",...t}))}catch(s){console.error("获取充电桩状态失败:",s)}},$=async()=>{try{const s=await _.get("/admin/piles"),t=await _.get("/admin/queue/summary");i.value.totalPiles=s.length,i.value.activePiles=s.filter(n=>n.is_active&&n.status!=="fault").length,i.value.queueLength=t.total_in_system}catch(s){console.error("获取统计数据失败:",s)}},q=async()=>{try{const s=new Date().toISOString().split("T")[0],n=(await _.get(`/admin/reports/daily?date=${s}`)).reduce((l,c)=>l+c.total_fee,0);i.value.todayRevenue=n}catch(s){console.error("获取今日收入失败:",s),i.value.todayRevenue=0}},O=s=>{if(s.status!=="charging")return 0;const t=s.charging_mode==="fast"?[40,50]:[15,20],n=(Math.random()-.5)*2,l=t[0]+Math.random()*(t[1]-t[0])+n;return Math.max(0,Number(l.toFixed(1)))},V=()=>{S(),d.success("状态已刷新")},A=async s=>{try{const t=v.value.find(n=>n.id===s);t&&(await _.post(`/admin/piles/${t.pile_id}/stop`),d.success(`充电桩 ${s} 已停止充电`),await g())}catch(t){console.error("停止充电失败:",t),d.error("停止充电失败")}},B=async s=>{try{const t=v.value.find(n=>n.id===s);t&&(await _.post(`/admin/piles/${t.pile_id}/start`),d.success(`充电桩 ${s} 维修完成`),await g())}catch(t){console.error("修复充电桩失败:",t),d.error("修复失败")}},I=()=>{if(y.value){const s=M(y.value),t={tooltip:{trigger:"axis"},xAxis:{type:"category",data:["00:00","04:00","08:00","12:00","16:00","20:00","24:00"]},yAxis:{type:"value",max:100},series:[{data:[20,15,45,80,90,85,60],type:"line",smooth:!0,areaStyle:{opacity:.3}}]};s.setOption(t)}if(w.value){const s=M(w.value),t={tooltip:{trigger:"axis"},xAxis:{type:"category",data:["周一","周二","周三","周四","周五","周六","周日"]},yAxis:{type:"value"},series:[{data:[850,920,1100,1200,1350,1600,1250],type:"bar",itemStyle:{color:"#409eff"}}]};s.setOption(t)}};return F(()=>{G(()=>{I(),S(),setInterval(()=>{g()},3e4)})}),(s,t)=>{const n=H,l=j,c=W,b=K,x=at,u=tt,T=et,N=Z;return C(),J("div",st,[e(b,{gutter:20,class:"stats-row"},{default:a(()=>[e(c,{span:6},{default:a(()=>[e(l,{class:"stats-card"},{default:a(()=>[o("div",ot,[o("div",nt,[e(n,null,{default:a(()=>[e(h(Q))]),_:1})]),o("div",lt,[o("div",rt,p(i.value.totalPiles),1),t[0]||(t[0]=o("div",{class:"stats-label"},"总充电桩数",-1))])])]),_:1})]),_:1}),e(c,{span:6},{default:a(()=>[e(l,{class:"stats-card"},{default:a(()=>[o("div",it,[o("div",ct,[e(n,null,{default:a(()=>[e(h(U))]),_:1})]),o("div",ut,[o("div",dt,p(i.value.activePiles),1),t[1]||(t[1]=o("div",{class:"stats-label"},"使用中充电桩",-1))])])]),_:1})]),_:1}),e(c,{span:6},{default:a(()=>[e(l,{class:"stats-card"},{default:a(()=>[o("div",_t,[o("div",pt,[e(n,null,{default:a(()=>[e(h(X))]),_:1})]),o("div",ft,[o("div",mt,p(i.value.queueLength),1),t[2]||(t[2]=o("div",{class:"stats-label"},"排队车辆",-1))])])]),_:1})]),_:1}),e(c,{span:6},{default:a(()=>[e(l,{class:"stats-card"},{default:a(()=>[o("div",vt,[o("div",gt,[e(n,null,{default:a(()=>[e(h(Y))]),_:1})]),o("div",ht,[o("div",yt,"¥"+p(i.value.todayRevenue),1),t[3]||(t[3]=o("div",{class:"stats-label"},"今日收入",-1))])])]),_:1})]),_:1})]),_:1}),e(b,{gutter:20,class:"charts-row"},{default:a(()=>[e(c,{span:12},{default:a(()=>[e(l,null,{header:a(()=>t[4]||(t[4]=[o("span",null,"充电桩使用率趋势",-1)])),default:a(()=>[o("div",{ref_key:"usageChart",ref:y,style:{height:"300px"}},null,512)]),_:1})]),_:1}),e(c,{span:12},{default:a(()=>[e(l,null,{header:a(()=>t[5]||(t[5]=[o("span",null,"收入趋势",-1)])),default:a(()=>[o("div",{ref_key:"revenueChart",ref:w,style:{height:"300px"}},null,512)]),_:1})]),_:1})]),_:1}),e(b,{gutter:20,class:"status-row"},{default:a(()=>[e(c,{span:24},{default:a(()=>[e(l,null,{header:a(()=>[t[7]||(t[7]=o("span",null,"充电桩实时状态",-1)),e(x,{type:"primary",size:"small",style:{float:"right"},onClick:V},{default:a(()=>t[6]||(t[6]=[m(" 刷新 ")])),_:1,__:[6]})]),default:a(()=>[e(N,{data:v.value,style:{width:"100%"}},{default:a(()=>[e(u,{prop:"id",label:"桩号",width:"80"}),e(u,{prop:"type",label:"类型",width:"100"},{default:a(r=>[e(T,{type:r.row.type==="fast"?"success":"info"},{default:a(()=>[m(p(r.row.type==="fast"?"快充":"慢充"),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"status",label:"状态",width:"120"},{default:a(r=>[e(T,{type:P(r.row.status),effect:"dark"},{default:a(()=>[m(p(R(r.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"power",label:"功率 (kW)",width:"120"}),e(u,{prop:"voltage",label:"电压 (V)",width:"120"}),e(u,{prop:"current",label:"电流 (A)",width:"120"}),e(u,{prop:"user",label:"使用用户"}),e(u,{prop:"startTime",label:"开始时间",width:"150"}),e(u,{label:"操作",width:"150"},{default:a(r=>[r.row.status==="charging"?(C(),E(x,{key:0,size:"small",type:"warning",onClick:L=>A(r.row.id)},{default:a(()=>t[8]||(t[8]=[m(" 停止充电 ")])),_:2,__:[8]},1032,["onClick"])):D("",!0),r.row.status==="fault"?(C(),E(x,{key:1,size:"small",type:"success",onClick:L=>B(r.row.id)},{default:a(()=>t[9]||(t[9]=[m(" 维修完成 ")])),_:2,__:[9]},1032,["onClick"])):D("",!0)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})])}}},Rt=z(wt,[["__scopeId","data-v-13b6d931"]]);export{Rt as default};
