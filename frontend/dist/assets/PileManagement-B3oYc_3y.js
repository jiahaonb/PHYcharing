import{_ as se}from"./_plugin-vue_export-helper-BCEt7Ct6.js";/* empty css                   *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                *//* empty css                      *//* empty css                  *//* empty css                     *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";/* empty css               *//* empty css                  */import{r as s,W as re,F as ue,c as ie,o as F,d as a,w as o,K as de,H as pe,I,m as u,b as y,a1 as me,G as ce,J as fe,i as ve,t as _e,x as q,ao as ge,X as we,Y as be,n as ye,aa as Ve,ab as Ce,V as xe,l as p,v as B,k as Ee,a6 as ke,ad as Ie,a7 as he,E as Se,h as $e,$ as Me,a8 as M}from"./index-DURBC1W6.js";const Pe={class:"pile-management"},Ue={class:"card-header"},ze={class:"filter-section"},De={class:"pagination"},Te={__name:"PileManagement",setup(Fe){const h=s(!1),_=s(""),V=s(""),C=s(""),d=s(1),g=s(10),S=s(0),m=s([]),x=s(!1),L=s(""),P=s(!1),w=s(),n=s({id:"",name:"",type:"",power:0,location:"",status:"normal"}),N={id:[{required:!0,message:"请输入桩编号",trigger:"blur"}],name:[{required:!0,message:"请输入桩名称",trigger:"blur"}],type:[{required:!0,message:"请选择桩类型",trigger:"change"}],power:[{required:!0,message:"请输入额定功率",trigger:"blur"}],location:[{required:!0,message:"请输入安装位置",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},O=re(()=>{let t=m.value;return _.value&&(t=t.filter(e=>e.id.toLowerCase().includes(_.value.toLowerCase())||e.name.toLowerCase().includes(_.value.toLowerCase()))),V.value&&(t=t.filter(e=>e.type===V.value)),C.value&&(t=t.filter(e=>e.status===C.value)),S.value=t.length,t.slice((d.value-1)*g.value,d.value*g.value)}),b=async()=>{h.value=!0;try{const t=await I.get("/admin/piles");m.value=t.map(e=>({id:e.pile_number,name:`${e.charging_mode==="fast"?"快充桩":"慢充桩"}-${e.pile_number}`,type:e.charging_mode,power:e.power,location:`停车位${e.pile_number}`,status:e.status,installDate:U(e.created_at),lastMaintenance:U(e.updated_at),originalId:e.id,...e})),S.value=m.value.length}catch(t){console.error("获取充电桩列表失败:",t),u.error("获取充电桩列表失败")}finally{h.value=!1}},U=t=>t?new Date(t).toISOString().split("T")[0]:"-",R=t=>({normal:"success",fault:"danger",maintenance:"warning"})[t]||"info",W=t=>({normal:"正常",fault:"故障",maintenance:"维护中"})[t]||"未知",j=()=>{d.value=1},z=()=>{d.value=1},G=t=>{g.value=t,d.value=1},H=t=>{d.value=t},J=()=>{n.value={id:"",name:"",type:"",power:0,location:"",status:"normal"},w.value&&w.value.resetFields()},K=async()=>{w.value&&await w.value.validate(t=>{if(t){if(P.value){const e=m.value.findIndex(c=>c.id===n.value.id);e!==-1&&(m.value[e]={...n.value},u.success("充电桩更新成功"))}else{if(m.value.some(c=>c.id===n.value.id)){u.error("充电桩编号已存在");return}m.value.push({...n.value,installDate:new Date().toISOString().split("T")[0],lastMaintenance:new Date().toISOString().split("T")[0]}),u.success("充电桩添加成功")}x.value=!1}})},Q=async t=>{try{await M.confirm(`确定要启动充电桩 ${t.id} 吗？`,"启动确认",{type:"success"}),await I.post(`/admin/piles/${t.originalId}/start`),u.success("充电桩已启动"),await b()}catch(e){e!=="cancel"&&(console.error("启动充电桩失败:",e),u.error("启动充电桩失败"))}},X=async t=>{try{await M.confirm(`确定要停止充电桩 ${t.id} 吗？`,"停止确认",{type:"warning"}),await I.post(`/admin/piles/${t.originalId}/stop`),u.success("充电桩已停止"),await b()}catch(e){e!=="cancel"&&(console.error("停止充电桩失败:",e),u.error("停止充电桩失败"))}},Y=async t=>{try{await M.confirm(`确定要设置充电桩 ${t.id} 为故障状态吗？`,"故障确认",{type:"warning"}),await I.post(`/admin/piles/${t.originalId}/fault`),u.success("充电桩已设置为故障状态"),await b()}catch(e){e!=="cancel"&&(console.error("设置故障状态失败:",e),u.error("设置故障状态失败"))}};return ue(()=>{b()}),(t,e)=>{const c=_e,f=Ee,E=ve,$=fe,r=be,k=we,A=ce,i=Ce,D=xe,Z=Ve,ee=Ie,ae=de,v=$e,le=Me,te=Se,oe=pe,ne=ke;return F(),ie("div",Pe,[a(ae,null,{header:o(()=>[y("div",Ue,[e[14]||(e[14]=y("span",null,"充电桩管理",-1)),a(f,{onClick:b},{default:o(()=>[a(c,null,{default:o(()=>[a(q(he))]),_:1}),e[13]||(e[13]=p(" 刷新 "))]),_:1,__:[13]})])]),default:o(()=>[y("div",ze,[a(A,{gutter:20},{default:o(()=>[a($,{span:6},{default:o(()=>[a(E,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=l=>_.value=l),placeholder:"搜索充电桩编号",clearable:"",onInput:j},{prefix:o(()=>[a(c,null,{default:o(()=>[a(q(ge))]),_:1})]),_:1},8,["modelValue"])]),_:1}),a($,{span:4},{default:o(()=>[a(k,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=l=>V.value=l),placeholder:"桩类型",clearable:"",onChange:z},{default:o(()=>[a(r,{label:"全部",value:""}),a(r,{label:"快充桩",value:"fast"}),a(r,{label:"慢充桩",value:"slow"})]),_:1},8,["modelValue"])]),_:1}),a($,{span:4},{default:o(()=>[a(k,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=l=>C.value=l),placeholder:"状态",clearable:"",onChange:z},{default:o(()=>[a(r,{label:"全部",value:""}),a(r,{label:"正常",value:"normal"}),a(r,{label:"故障",value:"fault"}),a(r,{label:"维护",value:"maintenance"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),me((F(),ye(Z,{data:O.value,style:{width:"100%","min-height":"400px"},"empty-text":"暂无充电桩数据"},{default:o(()=>[a(i,{prop:"id",label:"桩编号",width:"120"}),a(i,{prop:"name",label:"桩名称",width:"150"}),a(i,{prop:"type",label:"类型",width:"100"},{default:o(l=>[a(D,{type:l.row.type==="fast"?"success":"info"},{default:o(()=>[p(B(l.row.type==="fast"?"快充桩":"慢充桩"),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"power",label:"额定功率 (kW)",width:"120"}),a(i,{prop:"location",label:"位置"}),a(i,{prop:"status",label:"状态",width:"100"},{default:o(l=>[a(D,{type:R(l.row.status)},{default:o(()=>[p(B(W(l.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"installDate",label:"安装日期",width:"120"}),a(i,{prop:"lastMaintenance",label:"上次维护",width:"120"}),a(i,{label:"操作",width:"200",fixed:"right"},{default:o(l=>[a(f,{size:"small",type:"success",onClick:T=>Q(l.row),disabled:l.row.status==="normal"},{default:o(()=>e[15]||(e[15]=[p(" 启动 ")])),_:2,__:[15]},1032,["onClick","disabled"]),a(f,{size:"small",type:"warning",onClick:T=>Y(l.row),disabled:l.row.status==="fault"},{default:o(()=>e[16]||(e[16]=[p(" 故障 ")])),_:2,__:[16]},1032,["onClick","disabled"]),a(f,{size:"small",type:"info",onClick:T=>X(l.row)},{default:o(()=>e[17]||(e[17]=[p(" 停止 ")])),_:2,__:[17]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,h.value]]),y("div",De,[a(ee,{"current-page":d.value,"onUpdate:currentPage":e[3]||(e[3]=l=>d.value=l),"page-size":g.value,"onUpdate:pageSize":e[4]||(e[4]=l=>g.value=l),"page-sizes":[10,20,50,100],total:S.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:G,onCurrentChange:H},null,8,["current-page","page-size","total"])])]),_:1}),a(oe,{modelValue:x.value,"onUpdate:modelValue":e[12]||(e[12]=l=>x.value=l),title:L.value,width:"600px",onClose:J},{footer:o(()=>[a(f,{onClick:e[11]||(e[11]=l=>x.value=!1)},{default:o(()=>e[19]||(e[19]=[p("取消")])),_:1,__:[19]}),a(f,{type:"primary",onClick:K},{default:o(()=>e[20]||(e[20]=[p("确定")])),_:1,__:[20]})]),default:o(()=>[a(te,{ref_key:"formRef",ref:w,model:n.value,rules:N,"label-width":"100px"},{default:o(()=>[a(v,{label:"桩编号",prop:"id"},{default:o(()=>[a(E,{modelValue:n.value.id,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.id=l),disabled:P.value},null,8,["modelValue","disabled"])]),_:1}),a(v,{label:"桩名称",prop:"name"},{default:o(()=>[a(E,{modelValue:n.value.name,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.name=l)},null,8,["modelValue"])]),_:1}),a(v,{label:"桩类型",prop:"type"},{default:o(()=>[a(k,{modelValue:n.value.type,"onUpdate:modelValue":e[7]||(e[7]=l=>n.value.type=l),placeholder:"请选择桩类型"},{default:o(()=>[a(r,{label:"快充桩",value:"fast"}),a(r,{label:"慢充桩",value:"slow"})]),_:1},8,["modelValue"])]),_:1}),a(v,{label:"额定功率",prop:"power"},{default:o(()=>[a(le,{modelValue:n.value.power,"onUpdate:modelValue":e[8]||(e[8]=l=>n.value.power=l),min:1,max:100,"controls-position":"right"},null,8,["modelValue"]),e[18]||(e[18]=y("span",{style:{"margin-left":"10px"}},"kW",-1))]),_:1,__:[18]}),a(v,{label:"安装位置",prop:"location"},{default:o(()=>[a(E,{modelValue:n.value.location,"onUpdate:modelValue":e[9]||(e[9]=l=>n.value.location=l)},null,8,["modelValue"])]),_:1}),a(v,{label:"状态",prop:"status"},{default:o(()=>[a(k,{modelValue:n.value.status,"onUpdate:modelValue":e[10]||(e[10]=l=>n.value.status=l),placeholder:"请选择状态"},{default:o(()=>[a(r,{label:"正常",value:"normal"}),a(r,{label:"故障",value:"fault"}),a(r,{label:"维护",value:"maintenance"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ae=se(Te,[["__scopeId","data-v-b57a1437"]]);export{Ae as default};
